name: CI - Test All Services

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  JAVA_VERSION: "21"

jobs:
  # ---------------------------------------------------------------------------
  # Unit tests for each service (run in parallel)
  # ---------------------------------------------------------------------------
  test-auth-service:
    name: Test Auth Service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: auth-service
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: temurin
          cache: maven

      - name: Run tests
        run: ./mvnw verify -B

  test-patient-service:
    name: Test Patient Service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: patient-service
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: temurin
          cache: maven

      - name: Run tests
        run: ./mvnw verify -B

  test-billing-service:
    name: Test Billing Service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: billing-service
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: temurin
          cache: maven

      - name: Run tests
        run: ./mvnw verify -B

  test-analytics-service:
    name: Test Analytics Service
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: analytics-service
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: temurin
          cache: maven

      - name: Run tests
        run: ./mvnw verify -B

  test-api-gateway:
    name: Test API Gateway
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: api-gateway
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: temurin
          cache: maven

      - name: Run tests
        run: ./mvnw verify -B
